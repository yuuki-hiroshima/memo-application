{% extends "base.html" %}
{% block title %}プライベートメモ{% endblock %}
{% block content %}
<div class="page-header">
  <h1>プライベートメモ</h1>

  <div class="page-header-actions">
    <form action="/memos/new" method="GET">
      <button type="submit" class="button button-primary">新規作成</button>
    </form>
    <a href="/memos" class="button">一覧へ戻る</a>
  </div>
</div>

  {# フラッシュメッセージ表示（他の画面と同じ） #}
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flash-messages">
        <ul>
          {% for message in messages %}
            <li style="color: red;">{{ message }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  {% endwith %}

  {# ロック中：パスワード入力フォームだけ表示 #}
  {% if not memos %}
    <form method="POST" action="/private" class="private-password-form">
      <input type="password" name="password" placeholder="パスワードを入力" class="private-password-input">
      <button type="submit" class="button button-primary">開く</button>
    </form>

  {# ロック解除後：プライベートメモ一覧を表示 #}
  {% else %}

  <form action="/memos/bulk" method="POST">

    <div class="memo-table-wrapper">
      <table>
        <thead>
          <tr>
            <th class="col-select">選択</th>
            <th class="col-title">タイトル</th>
            <th class="col-body">本文</th>
            <th class="col-date">作成日</th>
            <th class="col-date">更新日</th>
            <th class="col-actions">操作</th>
          </tr>
        </thead>
        <tbody>
          {% for memo in memos %}
          <tr>
            <td class="col-select">
              <input type="checkbox" name="selected_ids" value="{{ memo.id }}">
            </td>
            <td class="col-title">
              <a href="/memos/{{ memo.id }}/edit">{{ memo["title"] }}</a>
            </td>
            <td class="col-body">
              {{ memo["body"][:24] }}
            </td>
            <td class="col-date">
              {{ memo.created_year }}<br>
              {{ memo.created_date }}<br>
              {{ memo.created_time }}
            </td>
            <td class="col-date">
              {{ memo.updated_year }}<br>
              {{ memo.updated_date }}<br>
              {{ memo.updated_time }}
            </td>
            <td class="col-actions table-actions">
              <a href="/memos/{{ memo.id }}/edit" class="button button-sm">
                編集
              </a>
              <a href="/memos/{{ memo.id }}/delete" class="button button-sm button-danger">
                削除
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="form-actions">
      <select name="move_category" class="form_input">
        <option value="">カテゴリを選択</option>
        {% for category in category_options %}
        <option value="{{ category }}">{{ category }}</option>
        {% endfor %}
      </select>
      <button type="submit" name="action" value="move" class="button">選択したメモを移動</button>
      <button type="submit" name="action" value="delete" class="button button-danger" onclick="return confirm('選択したメモを削除します。よろしいですか？')">選択したメモを削除</button>
    </div>
  </form>
  {% endif %}
{% endblock %}